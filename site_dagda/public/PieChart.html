<!DOCTYPE html>
<!-- saved from url=(0054)https://www.chartjs.org/samples/latest/charts/pie.html -->
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Pie Chart</title>
	<script async="" src="./PieChart_files/analytics.js.download"></script>
	<script src="./PieChart_files/Chart.min.js.download"></script>
	<script src="./PieChart_files/utils.js.download"></script>
	<script src="js/script.js"></script>


	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.23/angular.min.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.1/nv.d3.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.1/nv.d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-nvd3/1.0.5/angular-nvd3.min.js"></script>

	<div ng-app="meuApp">
		<div ng-controller="MeuController as vm">
			<nvd3 options="vm.opcoes" data="vm.dados"></nvd3>
		</div>
	</div>

</head>

<body style="overflow: hidden;">
	<center>
		<div id="canvas-holder" style="width:100%">
			<div class="chartjs-size-monitor">
				<div class="chartjs-size-monitor-expand">
					<div class=""></div>
				</div>
				<div class="chartjs-size-monitor-shrink">
					<div class=""></div>
				</div>
				<br><br>
			</div>
			<canvas id="chart-area" style="display: block; width: 762px; height: 381px;" width="5" height="3"
				class="chartjs-render-monitor"></canvas>
		</div>
	</center>
</body>

<script>
	var randomScalingFactor = function () {
		return Math.round(Math.random() * 100);
	};

	// var config = {
	// 	type: 'pie',
	// 	data: {
	// 		datasets: [{
	// 			data: [
	// 				randomScalingFactor(),
	// 				randomScalingFactor(),
	// 				randomScalingFactor(),
	// 			],
	// 			backgroundColor: [
	// 				window.chartColors.yellow,
	// 				window.chartColors.red,
	// 				window.chartColors.green
	// 			],
	// 			label: 'Dataset 1'
	// 		}],
	// 		labels: [
	// 			'Moderável',
	// 			'Crítico',
	// 			'Estável'
	// 		]
	// 	},
	// 	options: {
	// 		responsive: true,
	// 		title: {
	// 			display: true,
	// 			text: 'Estado dos Trafos'
	// 		}
	// 	}
	// };

	/////////////////////////////////////////////////

	angular
		.module('meuApp', ['nvd3'])
		.controller('MeuController', MeuController);

	MeuController.$inject = [];

	function MeuController() {
		var vm = this;

		vm.opcoes = {
			chart: {
				type: 'pieChart',
				pie: {
					dispatch: {
						elementClick: function (evento) { console.log(evento) }
					}
				},
				height: 500,
				x: function (d) {
					return d.key;
				},
				y: function (d) {
					return d.y;
				},
				showLabels: true,
				duration: 500,
				labelThreshold: 0.01,
				labelSunbeamLayout: true,
				legend: {
					margin: {
						top: 5,
						right: 35,
						bottom: 5,
						left: 0
					}
				}
			}
		};

		vm.dados = [
			{ key: "Crítico", y: randomScalingFactor() },
			{ key: "Estável", y: randomScalingFactor() },
			{ key: "Moderado", y: randomScalingFactor() }
		];
	};

	///////////////////////////////////////////////////////////////

	function receberNovasLeituras() {
		setTimeout(() => {

			// esse "novoRegistro" será recuperado do backend futuramente
			var novoRegistro = {
				data: randomScalingFactor()
			};

			// tirando e colocando valores no gráfico
			config.data.datasets[0].data.shift();  // apagar o primeiro
			config.data.datasets[0].data.push(novoRegistro.data); // incluir uma nova leitura

			// Atualiza o gráfico
			window.myPie.update();

			// agendar a chamada da mesma função para daqui a 5 segundos
			receberNovasLeituras();

		}, 5); // 5000 ms -> 5 segundos
	}

	window.onload = function () {
		var ctx = document.getElementById('chart-area').getContext('2d');
		window.myPie = new Chart(ctx, config);

		receberNovasLeituras();
	};

</script>

</html>